<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sobrevive a los Zombis</title>
  <style>
    body {
      background: #000;
      color: #eee;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px;
    }

    #game {
      display: grid;
      grid-template-columns: repeat(15, 30px);
      grid-template-rows: repeat(15, 30px);
      gap: 2px;
      background: #222;
      border: 3px solid #555;
    }

    .cell {
      width: 30px;
      height: 30px;
      background: #333;
      border-radius: 4px;
      position: relative;
    }

    .player {
      background: limegreen;
      border-radius: 50%;
    }

    .zombie {
      background: crimson;
      border-radius: 50%;
    }

    .bullet {
      background: yellow;
      width: 10px;
      height: 10px;
      position: absolute;
      top: 10px;
      left: 10px;
      border-radius: 50%;
    }

    #info {
      margin-top: 10px;
      font-size: 18px;
    }

    #message {
      margin-top: 15px;
      font-size: 24px;
      color: #ff4444;
      font-weight: bold;
    }

    #restart-btn {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      background: #444;
      border: none;
      border-radius: 6px;
      color: #eee;
      transition: background 0.3s;
    }

    #restart-btn:hover {
      background: #666;
    }
  </style>
</head>

<body>

  <h1>Sobrevive a los Zombis</h1>
  <a href="index.html" class="btn">⬅ Volver al menú</a>
  <div id="game"></div>
  <div id="info">Tiempo sobrevivido: <span id="time">0</span> segundos</div>
  <div id="message"></div>
  <button id="restart-btn">Reiniciar Juego</button>

  <script>
    const rows = 15;
    const cols = 15;
    const game = document.getElementById('game');
    const timeEl = document.getElementById('time');
    const messageEl = document.getElementById('message');
    const restartBtn = document.getElementById('restart-btn');

    let grid = [];
    let player;
    let zombies;
    let bullets;
    let gameOver;
    let gameLoopId;
    let spawnIntervalId;
    let timeSurvived;
    let timeIntervalId;

    // Crear grid
    function createGrid() {
      game.innerHTML = '';
      grid = [];
      for (let r = 0; r < rows; r++) {
        const rowArr = [];
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.id = `cell-${r}-${c}`;
          game.appendChild(cell);
          rowArr.push(cell);
        }
        grid.push(rowArr);
      }
    }

    // Dibujar jugador
    function drawPlayer() {
      clearClass('player');
      if (!gameOver) {
        grid[player.row][player.col].classList.add('player');
      }
    }

    // Dibujar zombis
    function drawZombies() {
      clearClass('zombie');
      zombies.forEach(z => {
        grid[z.row][z.col].classList.add('zombie');
      });
    }

    // Dibujar balas
    function drawBullets() {
      clearClass('bullet');
      bullets.forEach(b => {
        const cell = grid[b.row][b.col];
        let bulletDiv = document.createElement('div');
        bulletDiv.classList.add('bullet');
        cell.appendChild(bulletDiv);
      });
    }

    // Limpiar clase de todas las celdas
    function clearClass(className) {
      const elements = document.querySelectorAll(`.${className}`);
      elements.forEach(el => el.classList.remove(className));
      if (className === 'bullet') {
        grid.flat().forEach(cell => {
          const bulletsInCell = cell.querySelectorAll('.bullet');
          bulletsInCell.forEach(b => b.remove());
        });
      }
    }

    // Mover jugador (con chequeo bordes)
    function movePlayer(dr, dc) {
      if (gameOver) return;
      let nr = player.row + dr;
      let nc = player.col + dc;
      if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
        player.row = nr;
        player.col = nc;
        drawPlayer();
        checkZombieCollision();
      }
    }

    // Mover zombis hacia el jugador
    function moveZombies() {
      if (gameOver) return;
      zombies.forEach(z => {
        let dr = 0;
        let dc = 0;
        if (z.row < player.row) dr = 1;
        else if (z.row > player.row) dr = -1;
        if (z.col < player.col) dc = 1;
        else if (z.col > player.col) dc = -1;

        let newRow = z.row + dr;
        let newCol = z.col + dc;

        if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols) {
          // Evitar que dos zombis ocupen misma celda (simple)
          if (!zombies.some(zombie => zombie !== z && zombie.row === newRow && zombie.col === newCol)) {
            z.row = newRow;
            z.col = newCol;
          }
        }
      });
    }

    // Disparar bala hacia arriba
    function shoot() {
      if (gameOver) return;
      bullets.push({ row: player.row - 1, col: player.col, direction: 'up' });
    }

    // Mover balas
    function moveBullets() {
      if (gameOver) return;
      let toRemove = [];
      bullets.forEach((b, i) => {
        if (b.direction === 'up') b.row--;
        if (b.row < 0) toRemove.push(i);
      });
      for (let i = toRemove.length - 1; i >= 0; i--) {
        bullets.splice(toRemove[i], 1);
      }
    }

    // Revisar colisiones bala-zombi
    function checkBulletHits() {
      let hits = [];
      bullets.forEach((b, bi) => {
        zombies.forEach((z, zi) => {
          if (b.row === z.row && b.col === z.col) {
            hits.push({ bullet: bi, zombie: zi });
          }
        });
      });
      // Eliminar zombis y balas, desde atrás para no romper indices
      hits.sort((a, b) => b.bullet - a.bullet).forEach(h => {
        zombies.splice(h.zombie, 1);
        bullets.splice(h.bullet, 1);
      });
    }

    // Revisar colisión jugador-zombi
    function checkZombieCollision() {
      for (let z of zombies) {
        if (z.row === player.row && z.col === player.col) {
          gameOver = true;
          messageEl.textContent = '¡Te atraparon los zombis! GAME OVER';
          clearInterval(gameLoopId);
          clearInterval(spawnIntervalId);
          clearInterval(timeIntervalId);
        }
      }
    }

    // Generar zombi en borde aleatorio
    function spawnZombie() {
      let edge = Math.floor(Math.random() * 4);
      let r, c;
      if (edge === 0) { // arriba
        r = 0; c = Math.floor(Math.random() * cols);
      } else if (edge === 1) { // abajo
        r = rows - 1; c = Math.floor(Math.random() * cols);
      } else if (edge === 2) { // izquierda
        r = Math.floor(Math.random() * rows); c = 0;
      } else { // derecha
        r = Math.floor(Math.random() * rows); c = cols - 1;
      }
      // No poner donde está el jugador o otro zombi
      if ((r === player.row && c === player.col) || zombies.some(z => z.row === r && z.col === c)) {
        return; // no spawnear esta vez
      }
      zombies.push({ row: r, col: c });
    }

    // Loop principal
    function gameLoop() {
      moveZombies();
      moveBullets();
      checkBulletHits();
      drawZombies();
      drawBullets();
      checkZombieCollision();
    }

    // Actualizar tiempo sobrevivido
    function updateTime() {
      timeSurvived++;
      timeEl.textContent = timeSurvived;
    }

    // Manejar teclado
    function handleKeydown(e) {
      if (gameOver) return;

      switch (e.key) {
        case 'ArrowUp': movePlayer(-1, 0); break;
        case 'ArrowDown': movePlayer(1, 0); break;
        case 'ArrowLeft': movePlayer(0, -1); break;
        case 'ArrowRight': movePlayer(0, 1); break;
        case ' ': shoot(); break;
      }
    }

    document.addEventListener('keydown', handleKeydown);

    // Reiniciar juego
    function restartGame() {
      clearInterval(gameLoopId);
      clearInterval(spawnIntervalId);
      clearInterval(timeIntervalId);
      messageEl.textContent = '';
      timeSurvived = 0;
      timeEl.textContent = timeSurvived;
      player = { row: 7, col: 7 };
      zombies = [];
      bullets = [];
      gameOver = false;
      createGrid();
      drawPlayer();
      drawZombies();
      drawBullets();
      gameLoopId = setInterval(gameLoop, 300);
      spawnIntervalId = setInterval(spawnZombie, 2000);
      timeIntervalId = setInterval(updateTime, 1000);
    }

    restartBtn.addEventListener('click', restartGame);

    // Inicializar juego al cargar
    restartGame();
  </script>

</body>

</html>